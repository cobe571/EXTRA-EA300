<?xml version="1.0"?>

<!-- =====================================
               Extra EA 300 FCS      
        Patrizio MELIS Â© 2017 2018 2019
		   
          GNU GENERAL PUBLIC LICENSE
            Version 2, June 1991
     ===================================== -->

<system name="EA300: FCS">
	
	<channel name="Control Inputs">
		
		<lag_filter name="fcs/aileron-yoke">
			<input>/controls/flight/aileron</input>
			<c1>20</c1>
		</lag_filter>
		
		<lag_filter name="fcs/elevator-yoke">
			<input>/controls/flight/elevator</input>
			<c1>20</c1>
		</lag_filter>
		
		<lag_filter name="fcs/elevator-trim-knob">
			<input>/controls/flight/elevator-trim</input>
			<c1>20</c1>
		</lag_filter>
		
		<lag_filter name="fcs/rudder-pedal">
			<input>/controls/flight/rudder</input>
			<c1>20</c1>
		</lag_filter>
		
		<lag_filter name="fcs/rudder-trim-knob">
			<input>/controls/flight/rudder-trim</input>
			<c1>20</c1>
		</lag_filter>
	
	</channel>
	
	<channel name="Ailerons">
		
		<aerosurface_scale name="fcs/aileron-left-deg">
			<input>fcs/aileron-yoke</input>
			<range>
				<min>-30</min>
				<max>30</max>
			</range>
			<output>fcs/left-aileron-pos-norm</output> <!-- Is really degrees, for MP transit -->
		</aerosurface_scale>
		
		<aerosurface_scale name="fcs/aileron-right-deg">
			<input>-fcs/aileron-yoke</input>
			<range>
				<min>-30</min>
				<max>30</max>
			</range>
			<output>fcs/right-aileron-pos-norm</output> <!-- Is really degrees, for MP transit -->
		</aerosurface_scale>
	
	</channel>
	
	<channel name="Elevator">
		
		<fcs_function name="fcs/elevator-trim-offset">
			<description>Pretends to slew neutral force point on elevator without limiting range of yoke</description>
			<function>
				<product>
					<property>fcs/elevator-trim-knob</property>
					<value>0.6</value>
					<table>
						<independentVar lookup="row">fcs/elevator-yoke</independentVar> <!-- Fade out trim bias with yoke movement, prevents authority loss due to trim which doesn't happen on the PA28 -->
						<independentVar lookup="column">aero/qbar-psf</independentVar> <!-- Need airflow for trim tab to effect -->
						<tableData>
							    2     5
							-1  0.00  0.00
							 0  0.00  0.75
							 1  0.00  0.00
						</tableData>
					</table>
				</product>
			</function>
		</fcs_function>
		
		<summer name="fcs/pitch-input">
			<input>fcs/elevator-yoke</input>
			<input>fcs/elevator-trim-offset</input>
			<clipto>
				<min>-1.0</min>
				<max>1.0</max>
			</clipto>
		</summer>
		
		<aerosurface_scale name="fcs/elevator-deg">
			<input>fcs/pitch-input</input>
			<range>
				<min>-25</min>
				<max>25</max>
			</range>
			<output>fcs/elevator-pos-norm</output> <!-- Is really degrees, but for MP transit -->
		</aerosurface_scale>
		
		<fcs_function name="fcs/elevator-tab-deg">
			<function>
				<product>
					<property>fcs/elevator-trim-knob</property>
					<value>-15</value>
				</product>
			</function>
			<output>fcs/speedbrake-pos-norm</output> <!-- Is really degrees, but for MP transit -->
		</fcs_function>
	
	</channel>
	
	<channel name="Rudder">
		
		<summer name="fcs/yaw-input">
			<input>fcs/rudder-pedal</input>
			<input>fcs/rudder-trim-knob</input>
			<clipto>
				<min>-1</min>
				<max>1</max>
			</clipto>
		</summer>
		
		<aerosurface_scale name="fcs/rudder-deg">
			<input>fcs/yaw-input</input>
			<range>
				<min>-30</min>
				<max>30</max>
			</range>
			<output>fcs/rudder-pos-norm</output> <!-- Is really degrees, but for MP transit -->
		</aerosurface_scale>
	
	</channel>
	
	<channel name="Nose Wheel">
		
		<fcs_function name="fcs/steer-function">
			<function>
				<table>
					<independentVar lookup="row">/velocities/groundspeed-kt</independentVar>
					<independentVar lookup="column">/controls/flight/rudder</independentVar>
					<tableData>
							   -1     0    1
						 0.500  00.0  0.0  00.0
						 1.000  50.0  0.0 -50.0
					</tableData>
				</table>
			</function>
		</fcs_function>
		
		<actuator name="fcs/steer-deg">
			<input>fcs/steer-function</input>
			<rate_limit>190</rate_limit>
			<output>fcs/steer-pos-deg</output>
		</actuator>
	
	</channel>

</system>
